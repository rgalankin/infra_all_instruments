---
id: 20260224150100-03
title: "PostgreSQL Mac Docker"
summary: >
  Dev-окружение PostgreSQL на локальном Mac (127.0.0.1). Docker-контейнер postgres:15-alpine.
  2 БД: drive_ml (ML-проект), n8n (dev instance). Критичность LOW (dev only).
type: spec
status: active
tags: [eng/infrastructure, eng/database, platform/postgresql, platform/docker, dev]
source: roman
ai_weight: low
created: 2026-02-24
updated: 2026-02-24
criticality: low
---
# POSTGRESQL MAC DOCKER

## ОСНОВНАЯ ИНФОРМАЦИЯ

| Параметр | Значение |
|----------|----------|
| Сервер | Mac Local (Docker Desktop) |
| IP | 127.0.0.1 |
| Порт | 5432 (по умолчанию, можно переопределить через DB_PORT) |
| Версия | PostgreSQL 15 (postgres:15-alpine) |
| Расположение | /Users/mac/Documents/documentoved/docker-compose.yml |
| Docker сеть | drive_network |
| Критичность | LOW (dev only) |

## НАЗНАЧЕНИЕ

Локальное dev-окружение для ML-проекта Drive ML. Не используется в production.

## БАЗЫ ДАННЫХ

| База | Назначение | Владелец | Статус |
|------|-----------|----------|--------|
| **drive_ml** | ML-проект: векторные эмбеддинги, feature store | admin | active |
| **n8n** | n8n dev instance для тестирования workflows | admin | active |

**Бэкапы:** не нужны (dev-only, можно пересоздать)

## DOCKER COMPOSE

**Путь:** `/Users/mac/Documents/documentoved/docker-compose.yml`

**Конфигурация PostgreSQL:**
```yaml
services:
  postgres:
    image: postgres:15-alpine
    container_name: drive_postgres
    restart: unless-stopped
    environment:
      POSTGRES_DB: ${DB_NAME:-drive_ml}
      POSTGRES_USER: ${DB_USER:-admin}
      POSTGRES_PASSWORD: ${DB_PASSWORD:-ChangeMePassword123}
      POSTGRES_INITDB_ARGS: "--encoding=UTF8 --locale=ru_RU.UTF-8"
    ports:
      - "${DB_PORT:-5432}:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./docker/postgres/init.sql:/docker-entrypoint-initdb.d/01_init.sql
      - ./docker/postgres/migrations:/docker-entrypoint-initdb.d/migrations:ro
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${DB_USER:-admin} -d ${DB_NAME:-drive_ml}"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - drive_network
```

**Также включает:**
- n8n (порт 5678) — использует PostgreSQL для state
- ml-server (FastAPI, порт 8002) — ML API
- pgAdmin (опционально, порт 5050, запускается через --profile tools)

## ПОДКЛЮЧЕНИЕ

### psql
```bash
psql -h 127.0.0.1 -U admin -d drive_ml
# Пароль: ChangeMePassword123 (или из .env)
```

### n8n БД
```bash
psql -h 127.0.0.1 -U admin -d n8n
```

### pgAdmin
Запустить с профилем:
```bash
docker-compose --profile tools up -d pgadmin
```

Открыть: http://localhost:5050
- Email: admin@example.com
- Password: admin

## СХЕМА drive_ml

**Назначение:** ML feature store, эмбеддинги, метаданные моделей

**Таблицы:**
- TBD (зависит от ML-проекта Drive ML)

**Инициализация:** `/docker/postgres/init.sql` + `/docker/postgres/migrations/`

## ОПЕРАЦИИ

### Запуск
```bash
cd /Users/mac/Documents/documentoved
docker-compose up -d postgres
```

### Остановка
```bash
docker-compose down
```

### Полная очистка (удалить данные)
```bash
docker-compose down -v
# Это удалит volume postgres_data
```

### Логи
```bash
docker-compose logs -f postgres
```

### Бэкап (если нужно)
```bash
docker exec drive_postgres pg_dump -U admin drive_ml > drive_ml_backup.sql
```

### Восстановление
```bash
docker exec -i drive_postgres psql -U admin -d drive_ml < drive_ml_backup.sql
```

## КОНФИГУРАЦИЯ (.env)

**Путь:** `/Users/mac/Documents/documentoved/.env`

**Переменные:**
```bash
DB_NAME=drive_ml
DB_USER=admin
DB_PASSWORD=ChangeMePassword123
DB_PORT=5432

# pgAdmin (опционально)
PGADMIN_EMAIL=admin@example.com
PGADMIN_PASSWORD=admin
PGADMIN_PORT=5050
```

## ОТЛИЧИЯ ОТ PRODUCTION

| Аспект | Dev (Mac) | Production (Beget/USA) |
|--------|-----------|------------------------|
| Версия | PostgreSQL 15 | PostgreSQL 16 |
| Доступ | localhost только | localhost через SSH tunnel |
| Бэкапы | нет | ежедневные |
| Мониторинг | нет | disk/connections alerts |
| Ресурсы | unlimited (Docker Desktop) | CPU/memory limits |
| Критичность | LOW | HIGH |

## ИСПОЛЬЗОВАНИЕ

**Для чего:**
- Разработка ML-моделей (Drive ML)
- Тестирование n8n workflows локально
- Эксперименты с PostgreSQL без риска для production

**Не использовать для:**
- Production данных
- Long-term хранения
- Критичных бизнес-процессов

## TODO

- [ ] Документировать схему drive_ml (после завершения ML-проекта)
- [ ] Настроить автоматический запуск при старте Mac (опционально)
- [ ] Создать скрипт для быстрого сброса БД (reset-db.sh)

## LINKS (INTERNAL)

- [[_index__20260224150000-01|Базы данных — реестр]]
- [[connect-guide__20260224150200-01|Подключение к PostgreSQL]]

## ИСТОРИЯ

- 2026-02-24: Создана карточка PostgreSQL Mac. Dev-only окружение для Drive ML.
