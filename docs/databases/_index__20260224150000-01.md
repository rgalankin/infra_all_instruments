---
id: 20260224150000-01
title: "Базы данных — реестр и карта"
summary: >
  Центральный реестр всех PostgreSQL серверов и баз данных. Точка входа для DBA-агента.
  Содержит инвентаризацию серверов, БД, критичности, статусов бэкапов.
type: index
status: active
tags: [eng/infrastructure, eng/database, platform/postgresql]
source: roman
ai_weight: high
created: 2026-02-24
updated: 2026-02-24
---
# БАЗЫ ДАННЫХ

## НАЗНАЧЕНИЕ

Центральный реестр PostgreSQL инфраструктуры. Используется:
- DBA-агентом для управления БД
- Sysadmin при диагностике
- DevOps при деплое новых сервисов

## РЕЕСТР СЕРВЕРОВ И БД

| Сервер | IP | Порт | БД | Назначение | Критичность | Бэкапы | Статус |
|--------|-----|------|-----|-----------|-------------|--------|--------|
| **Beget Russia** | 82.202.129.193 | 5432 | n8n | n8n workflow state | HIGH | Ежедневно | active |
| | | | credoserv_chat | CreditWise Chat OAuth/диалоги | HIGH | Ежедневно | active |
| | | | telegram_stories | Telegram Stories pipeline | MEDIUM | Ежедневно | active |
| | | | ebk | EBK проект (legacy?) | LOW | Планируется | unknown |
| **ISHosting USA** | 149.33.4.37 | 5432 | documentoved_contacts | Documentoved контакты | HIGH | Планируется | planning |
| | | | n8n | n8n для Documentoved | HIGH | Планируется | planning |
| **Mac Docker** | 127.0.0.1 | 5432 | drive_ml | ML-проект (dev only) | LOW | Нет | active |
| | | | n8n | n8n dev instance | LOW | Нет | active |

**Итого:** 3 сервера, 8 баз данных (5 production, 3 dev)

## КРИТИЧНОСТЬ

- **HIGH** (5 БД): простой > 1 часа критичен для бизнеса
- **MEDIUM** (1 БД): можно восстановить за 2-4 часа
- **LOW** (2 БД): dev-окружения, можно пересоздать

## СТАТУС БЭКАПОВ

### Production (Beget)
- **Реализовано:** автоматические бэкапы через Docker volume snapshots (ежедневно, хранение 7 дней)
- **Проверено:** последний бэкап 2026-02-23
- **Восстановление:** не тестировалось (TODO: запланировать DR drill)

### USA (ISHosting)
- **Статус:** сервер настроен, PostgreSQL не развёрнут (задача #1022)
- **План:** pg_dump + S3 backup при деплое

### Mac (Docker)
- **Статус:** бэкапы не нужны (dev-only)

## КАРТОЧКИ СЕРВЕРОВ

Детальные спецификации:

1. [[postgres-beget__20260224150100-01|PostgreSQL Beget Russia]] — production сервер, Docker, 4 БД
2. [[postgres-usa__20260224150100-02|PostgreSQL ISHosting USA]] — планируется Documentoved deployment
3. [[postgres-mac__20260224150100-03|PostgreSQL Mac Docker]] — dev-окружение

## ОПЕРАЦИОННЫЕ ПРОЦЕДУРЫ

Runbooks для DBA:

- [[connect-guide__20260224150200-01|Подключение к PostgreSQL]] — psql, pgAdmin, tunnels
- [[backup-restore__20260224150200-02|Бэкапы и восстановление]] — pg_dump/pg_restore, DR procedures
- [[monitoring__20260224150200-03|Мониторинг БД]] — disk, connections, slow queries

## TODO (ПРИОРИТИЗИРОВАНО)

### P0 (Критично)
- [ ] #1022 Развернуть PostgreSQL на USA-сервере (Documentoved)
- [ ] Протестировать восстановление бэкапов Beget (DR drill)

### P1 (Важно)
- [ ] Настроить мониторинг диска на Beget (alert при >80%)
- [ ] Настроить бэкапы USA → S3
- [ ] Документировать схемы всех БД (ERD диаграммы)

### P2 (Желательно)
- [ ] Исследовать ebk БД — используется или можно удалить?
- [ ] Настроить slow query logging
- [ ] Создать read-replica для credoserv_chat (если нагрузка вырастет)

## LINKS (INTERNAL)

- [[infra_all_instruments/registry__20260210220000-01|Registry All Instruments]]
- [[infra_all_instruments/docs/infrastructure/_index__20260210220000-03|Инфраструктура]]
- [[infra_all_instruments/docs/infrastructure/vps-beget__20260210220200-01|VPS Beget]]
- [[infra_all_instruments/docs/infrastructure/vps-ishosting-usa__20260212220200-01|VPS ISHosting USA]]
- [[infra_all_instruments/docs/tools/docker__20260210220200-03|Docker]]

## ИСТОРИЯ

- 2026-02-24: Создан реестр БД по задаче #1020. Инвентаризация 3 серверов, 8 БД.
