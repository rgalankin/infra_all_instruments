---
id: openclaw__20260224
title: "OpenClaw - платформа AI-агентов с multi-channel gateway"
summary: >
  Персональный AI-ассистент с multi-channel gateway (18+ каналов: Telegram, WhatsApp,
  Discord, Slack и др.). Построен на pi-mono. Используется как центральный gateway
  для общения CEO с AI-агентами (Клод, Софья) через мессенджеры. Установлен на Mac
  и US VPS (149.33.4.37).
type: spec
status: active
tags: [ai/agentops, platform/telegram, platform/whatsapp, eng/nodejs, eng/docker, eng/typescript]
source: claude-opus-4-6
ai_weight: high
created: 2026-02-24
updated: 2026-02-24
category: "AI - Agent Gateway / Multi-Channel"
version: "2026.2.22-2"
criticality: high
platform: cross-platform
cost: "open-source (MIT)"
---

# OpenClaw

## Основная информация

- **Категория:** AI - Agent Gateway / Multi-Channel
- **Тип:** Multi-channel AI gateway + coding agent CLI + TUI
- **Версия:** 2026.2.22-2 (npm latest, 35+ релизов)
- **Статус:** активно, используется
- **Критичность:** высокая
- **Лицензия:** MIT
- **Автор:** Mario Zechner (badlogic, exe.dev)
- **Репозиторий:** github.com/badlogic/openclaw
- **npm:** `openclaw`
- **Язык:** TypeScript (ESM), Node.js 22+
- **Платформа:** cross-platform (macOS, Linux)
- **Стоимость:** бесплатно (open-source)
- **Зависимость:** pi-mono (github.com/badlogic/pi-mono, 14.9K stars)

## Описание

OpenClaw - персональный AI-ассистент с multi-channel gateway, поддерживающий 18+ каналов коммуникации. Позволяет общаться с AI-агентами через любые мессенджеры (Telegram, WhatsApp, Discord, Slack, Signal, iMessage, Google Chat, MS Teams, WebChat, Matrix, Zalo и др.) через единый gateway.

Ключевые возможности:
- **Multi-channel gateway** - единая точка входа для всех мессенджеров
- **Isolated agents** - создание изолированных агентов с отдельными workspace и моделями
- **Routing rules** - привязка каналов/аккаунтов к агентам через `--bind`
- **Skills system** - bundled + managed + workspace skills
- **Coding agent CLI** - встроенный агент для работы с кодом
- **TUI** - терминальный интерфейс
- **ACP (Agent Control Protocol)** - стандартный протокол для внешних интеграций

## Наш Use Case

### Основная задача
Обеспечить CEO (Роман Галанкин) возможность общаться с AI Director (Клод Антропов) и Personal Assistant (Софья Ларина) через Telegram. Каждый агент имеет собственного Telegram-бота.

### Архитектура (выбран Вариант 2 - два бота)

```
CEO пишет в @klod_ai_director_bot      CEO пишет в @sofia_assistant_bot
              |                                      |
       OpenClaw Gateway                       OpenClaw Gateway
              |                                      |
         Agent "klod"                           Agent "sofia"
       (AI Director)                         (Personal Assistant)
       claude-opus-4                          claude-sonnet-4
       workspace: agents/ai_director/        workspace: agents/personal_assistant/
```

### Созданные агенты

| Агент | Имя | Модель | Workspace | Эмодзи |
|-------|-----|--------|-----------|--------|
| klod | Клод Антропов | claude-opus-4 | agents/ai_director/ | (галстук) |
| sofia | Софья Ларина | claude-sonnet-4 | agents/personal_assistant/ | (блокнот) |

Workspace агентов указывают на наши существующие папки с AGENTS.md, CLAUDE.md, context, skills, logs. OpenClaw читает роль и инструкции оттуда.

### Интеграция B24 (Phase A)

```
Bitrix24 (webhook ONTASKADD)
       |
       v
     n8n (US VPS :5678, workflow: b24-chat-router)
       |
       v
FastAPI Agent Gateway (US VPS :8090, POST /run-agent)
       |
       v
OpenClaw Gateway (US VPS Docker :18789, WebSocket + HTTP API)
       |
       v
LLM Router (US VPS :8080) / Anthropic API
```

## Установка и конфигурация

### Системные требования

| Параметр | Требование |
|----------|------------|
| Node.js | >= 22.12.0 |
| pnpm | 10.23.0 (для сборки из исходников) |
| RAM | ~1.5-2 GB (NODE_OPTIONS max-old-space-size=1536) |
| Disk | ~500 MB (image + deps) |
| Ports | 18789 (Gateway WebSocket), 18790 (HTTP Bridge) |

### Установка через npm (глобальная)

```bash
npm install -g openclaw@latest
```

### Установка через Docker (рекомендуемая для серверов)

Dockerfile:
```dockerfile
FROM node:22-bookworm
RUN npm install -g openclaw@latest
ENV NODE_ENV=production
ENV OPENCLAW_STATE_DIR=/data
ENV NODE_OPTIONS="--max-old-space-size=1536"
USER node
WORKDIR /home/node
CMD ["openclaw", "gateway", "--bind", "lan", "--port", "18789"]
```

Docker Compose:
```yaml
services:
  openclaw-gateway:
    image: openclaw:local
    container_name: openclaw-gateway
    restart: unless-stopped
    environment:
      OPENCLAW_STATE_DIR: /data
      NODE_OPTIONS: "--max-old-space-size=1536"
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN}
    volumes:
      - openclaw_config:/home/node/.openclaw
      - openclaw_workspace:/home/node/.openclaw/workspace
      - openclaw_data:/data
    ports:
      - "127.0.0.1:18789:18789"
      - "127.0.0.1:18790:18790"
    networks:
      - hub-network
    init: true
```

### Архитектура OpenClaw

```
Каналы (WhatsApp, Telegram, Slack, Discord, Signal, iMessage, Google Chat, MS Teams, WebChat, Matrix, Zalo)
         |
         v
+---------------------------+
|        Gateway            |
|    (control plane)        |
|  ws://127.0.0.1:18789    |
+---------------------------+
         |
    +----+----+----+----+
    |         |         |
 Pi Agent  CLI     WebChat UI
  (RPC)   (openclaw)
```

Компоненты:
- **Gateway** - WebSocket control plane (порт 18789)
- **Bridge** - HTTP мост для внешних интеграций (порт 18790)
- **Pi Agent** - AI runtime (RPC mode) с tool calling
- **CLI** - `openclaw agent`, `openclaw send`, `openclaw gateway`, `openclaw tui`
- **Skills** - bundled + managed + workspace skills

### Зависимости от pi-mono

OpenClaw использует 4 пакета из pi-mono:
- `@mariozechner/pi-agent-core` (0.49.3) - agent runtime, tool calling, state
- `@mariozechner/pi-ai` (0.49.3) - unified multi-provider LLM API
- `@mariozechner/pi-coding-agent` (0.49.3) - coding agent CLI
- `@mariozechner/pi-tui` (0.49.3) - terminal UI

Публикуются в npm. Отдельная установка pi-mono не требуется.

### Конфигурация LLM провайдеров

OpenClaw поддерживает:
- **Anthropic** (Claude Pro/Max, рекомендуется автором)
- **OpenAI** (ChatGPT/Codex)
- **Google** (Gemini, через env GEMINI_API_KEY)
- **GitHub Copilot** (через env GITHUB_TOKEN)
- Любые OpenAI-совместимые API (наш LLM Router)

```bash
# Настройка через CLI
openclaw config set providers.openai.apiBase http://llm-router:8080/v1
openclaw config set providers.openai.apiKey router-local-key

# Или прямой Anthropic
openclaw config set providers.anthropic.apiKey sk-ant-api03-...
```

### CLI-команды

```bash
# Gateway
openclaw gateway status          # Статус gateway
openclaw gateway                 # Запустить gateway

# Agents
openclaw agents add <name>       # Создать агента
openclaw agents add <name> --model anthropic/claude-opus-4 --bind telegram:<id>
openclaw agents set-identity <name> --name "Имя" --emoji "X"
openclaw agents list             # Список агентов

# Channels
openclaw channels add --channel telegram --token <BOT_TOKEN>
openclaw channels status         # Статус каналов

# Models
openclaw models status           # Статус провайдеров и ключей

# Agent mode
openclaw agent --message "Hello" --thinking off
openclaw agent --session-id <id> --message "Task"

# Config
openclaw configure --section model  # Интерактивная настройка
openclaw config set <key> <value>   # Прямое изменение конфига

# TUI
openclaw tui                     # Терминальный интерфейс
```

## Текущий статус развёртывания

### Mac (dev)

| Компонент | Статус | Детали |
|-----------|--------|--------|
| Binary | OK | v2026.2.19-2, /usr/local/bin/openclaw |
| Gateway config | OK | ~/.openclaw/openclaw.json |
| Gateway service | OK | LaunchAgent ai.openclaw.gateway, ws://127.0.0.1:18789 |
| Agent klod | OK | workspace: ~/Documents/ai_agents/agents/ai_director/ |
| Agent sofia | OK | workspace: ~/Documents/ai_agents/agents/personal_assistant/ |
| Workspace bootstrap | OK | .openclaw/ в папках обоих агентов |
| LLM Router integration | BLOCKED | auth-profiles.json не читается, baseURL не применяется |
| Telegram channels | PENDING | Ожидают токены ботов от CEO |

LaunchAgent plist: `~/Library/LaunchAgents/ai.openclaw.gateway.plist`
Логи: `~/.openclaw/logs/gateway.log`, `~/.openclaw/logs/gateway.err.log`
Dashboard: http://127.0.0.1:18789/

### US VPS (production)

| Компонент | Статус | Детали |
|-----------|--------|--------|
| Версия | OK | v2026.2.22-2 |
| Agent klod | OK | workspace: ~/ai_agents/agents/ai_director/ |
| Agent sofia | OK | workspace: ~/ai_agents/agents/personal_assistant/ |
| Config | OK | /home/roman/.openclaw/openclaw.json |
| Docker deploy | PENDING | Инструкция готова, ожидает SysAdmin |
| Systemd service | PENDING | /etc/systemd/system/openclaw.service |
| LLM Router | PENDING | Через hub-network (http://llm-router:8080/v1) |
| Telegram channels | PENDING | Ожидают токены ботов от CEO |

Целевая директория: /opt/hub/openclaw/
Docker network: hub-network (shared с n8n, llm-router, traefik)

## Известные проблемы

### 1. LLM Router Integration (BLOCKED)

OpenClaw не может читать auth-profiles.json с custom baseURL.

Попытки (все неуспешные):
1. File-based auth profile - OpenClaw видит файл, но не читает apiKey
2. Config-based baseURL - `Unrecognized key: "baseURL"`
3. Environment variables в LaunchAgent - Gateway не подхватывает env vars для OpenAI provider
4. Environment variables в shell - Ключ подхватывается, но baseURL через env не работает

Root cause: pi-ai ожидает OAuth tokens через `openclaw models auth login` (интерактивный) или API keys через auth-profiles.json со специфической структурой.

**Обходное решение:** прямой Anthropic API key (без LLM Router).

### 2. Telegram channels не подключены

Ожидают создания ботов в BotFather и получения токенов от CEO.

### 3. Workspace bootstrap файлы

OpenClaw создает .openclaw/ директории в workspace агентов (workspace-state.json). Это нормальное поведение, не конфликтует с нашей структурой.

## Интеграции

### С LLM Router
- Endpoint: http://llm-router:8080/v1 (через Docker hub-network)
- Статус: BLOCKED (auth issue)
- Альтернатива: прямой Anthropic API key

### С n8n
- OpenClaw Gateway имеет webhook endpoint и WebSocket API
- Webhook: POST http://openclaw-gateway:18789/api/send (через hub-network)
- WebSocket: ws://openclaw-gateway:18789 (для real-time events)

### С Bitrix24
- B24 не входит в список встроенных каналов OpenClaw
- Интеграция через n8n адаптер: B24 webhook - n8n - FastAPI Agent Gateway - OpenClaw
- Agent Gateway: ~/Documents/ai_agents/services/agent-gateway/ (FastAPI, порт 8090)

### С CLI Routing Table
- Зарегистрирован в `scripts/cli-exec.sh`:
  ```bash
  openclaw)
      CMD=(openclaw agent "$PROMPT")
      ;;
  ```
- Строка в CLI Routing Table: Messaging | CLI Fleet | `openclaw agent` | depends | variable

### С Git (синхронизация workspace)
```
Mac (разработка)              GitHub (backup)              US VPS (production)
~/Documents/ai_agents/  <->   rgalankin/ai_agents   <->    ~/ai_agents/
       |                                                          |
OpenClaw (локальный)                                     OpenClaw (daemon 24/7)
```

## Связанные задачи B24

| B24 # | Задача | Статус |
|-------|--------|--------|
| 746 | LLM Auto-Routing (мета-задача) | in_progress |
| 750 | OpenClaw US VPS setup | partial (gateway up, LLM Router blocked) |
| 758 | OpenClaw heartbeat (n8n cron) | pending |
| 760 | Telegram bot CEO | pending (ожидаем токены) |
| 762 | B24 webhook integration | in_progress (Phase A, T1-T2 done) |
| 900 | Каталогизация в infra_all_instruments | in_progress |

## Файловая структура на диске

### Конфигурация OpenClaw (Mac)

```
~/.openclaw/
  openclaw.json                       # Основной конфиг (agents, gateway settings)
  agents/
    klod/sessions/                    # Сессии диалогов AI Director
    sofia/sessions/                   # Сессии диалогов Personal Assistant
    main/agent/auth-profiles.json     # Auth для провайдеров LLM
  credentials/
  workspace/                          # Дефолтный workspace OpenClaw (pi-mono scaffold)
    .openclaw/workspace-state.json
    .git/
    AGENTS.md, BOOTSTRAP.md, HEARTBEAT.md, IDENTITY.md, SOUL.md, TOOLS.md, USER.md
  logs/
    gateway.log                       # Логи Gateway
    gateway.err.log                   # Ошибки Gateway
```

### Workspace агентов (Mac)

```
~/Documents/ai_agents/agents/
  ai_director/                    <- OpenClaw agent "klod" workspace
    .openclaw/workspace-state.json
    AGENTS.md (24KB)
    CLAUDE.md (16KB)
    context/, skills/, logs/
  personal_assistant/             <- OpenClaw agent "sofia" workspace
    .openclaw/workspace-state.json
    CLAUDE.md, context/, ...
```

### Agent Gateway (для B24 интеграции)

```
~/Documents/ai_agents/services/agent-gateway/
  app.py              # FastAPI: POST /run-agent, GET /health
  requirements.txt    # fastapi, uvicorn, aiohttp
  Dockerfile          # Python 3.12 slim
  docker-compose.yml  # Port 8090, hub-network
  .env.example        # OPENCLAW_BASE_URL, OPENCLAW_AUTH_TOKEN
  README.md
```

## Ресурсы и влияние на сервер (US VPS)

| Ресурс | Требование OpenClaw | US VPS total |
|--------|---------------------|--------------|
| RAM | +1.5-2 GB | 8 GB |
| Disk | +500 MB (image + data) | 50 GB SSD |
| CPU | минимальное (idle gateway) | 4x Xeon 2.2 GHz |
| Ports | 18789 (GW), 18790 (bridge) | свободны |

## Команды проверки

```bash
# Gateway
openclaw gateway status

# Models
openclaw models status

# Agents
openclaw agents list

# Channels
openclaw channels status

# Логи
tail -f ~/.openclaw/logs/gateway.log

# Dashboard (браузер)
open http://127.0.0.1:18789/

# Test agent (требует working auth)
openclaw agent --session-id test --message "Hello" --thinking off
```

## Реестр всех найденных файлов OpenClaw

### Документация (ai_agents)

| Файл | Тип | Описание |
|------|-----|----------|
| `ai_agents/docs/openclaw-telegram-architecture-options__20260223.md` | spec | Варианты архитектуры Telegram + OpenClaw (3 варианта, рекомендация, план) |
| `ai_agents/docs/llm-ops/openclaw-setup-plan__20260223.md` | note | Пошаговый план установки на US VPS (7 фаз, Docker, systemd) |

### Логи агентов

| Файл | Тип | Описание |
|------|-----|----------|
| `ai_agents/agents/ops_automation_lead/logs/b24-openclaw-integration__20260223.md` | note | B24 OpenClaw Integration Phase A (T0-T7, FastAPI Gateway) |
| `ai_agents/agents/sysadmin_agent/logs/openclaw-setup-mac__20260223.log` | log | Лог установки OpenClaw на Mac (partial success, LLM Router blocked) |
| `ai_agents/agents/ai_director/logs/llm-autorouting-project__20260223.log` | log | Project log LLM Auto-Routing (Phase 0-3, OpenClaw integration) |

### Сервисы

| Файл | Тип | Описание |
|------|-----|----------|
| `ai_agents/services/agent-gateway/app.py` | code | FastAPI proxy B24 - OpenClaw (POST /run-agent) |
| `ai_agents/services/agent-gateway/docker-compose.yml` | config | Docker Compose для Agent Gateway (port 8090) |
| `ai_agents/services/agent-gateway/Dockerfile` | config | Dockerfile Agent Gateway (Python 3.12 slim) |
| `ai_agents/services/agent-gateway/.env.example` | config | Env vars для Agent Gateway |
| `ai_agents/services/agent-gateway/README.md` | doc | Документация Agent Gateway |

### Конфигурация OpenClaw

| Файл | Тип | Описание |
|------|-----|----------|
| `~/.openclaw/openclaw.json` | config | Основной конфиг (agents, gateway) |
| `~/.openclaw/agents/main/agent/auth-profiles.json` | config | Auth profiles для LLM провайдеров |
| `~/Library/LaunchAgents/ai.openclaw.gateway.plist` | config | macOS LaunchAgent для автозапуска |

### Workspace файлы OpenClaw

| Файл | Тип | Описание |
|------|-----|----------|
| `~/.openclaw/workspace/` | dir | Дефолтный workspace (pi-mono scaffold с AGENTS.md, SOUL.md и др.) |
| `~/.openclaw/workspace/.openclaw/workspace-state.json` | state | Bootstrap timestamp (2026-02-23T15:58) |
| `ai_agents/agents/ai_director/.openclaw/workspace-state.json` | state | Bootstrap timestamp agent klod (2026-02-23T13:05) |
| `ai_agents/agents/personal_assistant/.openclaw/workspace-state.json` | state | Bootstrap timestamp agent sofia (2026-02-23T13:05) |

### Smart Environment кэш

| Файл | Тип | Описание |
|------|-----|----------|
| `.smart-env/multi/ai_agents_docs_openclaw-telegram-architecture-options__20260223_md.ajson` | cache | Embedding-кэш документа архитектуры |
| `.smart-env/multi/ai_agents_docs_llm-ops_openclaw-setup-plan__20260223_md.ajson` | cache | Embedding-кэш плана установки |
| `.smart-env/multi/ai_agents_agents_ops_automation_lead_logs_b24-openclaw-integration__20260223_md.ajson` | cache | Embedding-кэш лога интеграции |

### Упоминания в других файлах

| Файл | Контекст |
|------|----------|
| `ai_agents/docs/cli-routing-table__20260220.md` | Строка "Messaging - openclaw agent" в таблице маршрутизации |
| `ai_agents/scripts/cli-exec.sh` | Роутинг `openclaw)` - CMD=(openclaw agent "$PROMPT") |
| `ai_agents/docs/kb-audit-report__20260223.md` | Упоминание OpenClaw в контексте аудита KB |
| `ai_agents/agents/ai_director/IDENTITY.md` | Упоминание OpenClaw workspace |
| `ai_agents/agents/personal_assistant/IDENTITY.md` | Упоминание OpenClaw workspace |
| `ai_agents/agents/devops_agent/logs/devops_agent.log` | Упоминание OpenClaw в логах |
| `ai_agents/agents/system_process_architect/reports/structure-audit__20260223170000.md` | OpenClaw в аудите структуры |
| `ai_agents/agents/system_process_architect/reports/memory-architecture-recommendation__20260223190000.md` | OpenClaw в рекомендациях |
| `ai_agents/services/memory-system/migrations/002_extended_tables.sql` | Таблица для OpenClaw данных |

## Links (internal)

- [[openclaw-telegram-architecture-options__20260223]] - варианты архитектуры Telegram
- [[openclaw-setup-plan__20260223]] - план установки на US VPS
- [[b24-openclaw-integration__20260223]] - B24 интеграция Phase A
- [[llm-autorouting-project__20260223]] - project log LLM Auto-Routing
- [[cli-routing-table__20260220]] - CLI Routing Table
- [[llm-router__20260219]] - LLM Router
- [[vps-ishosting-usa__20260212220200-01]] - US VPS (ISHosting NYC)
