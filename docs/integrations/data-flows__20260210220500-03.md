---
id: 20260210220500-03
title: "Потоки данных"
summary: >
  Карта всех потоков данных в инфраструктуре: Telegram→n8n→Bitrix24,
  OCR pipeline, синхронизация Google Drive, LLM API routing.
type: spec
status: active
tags: [eng/integration, eng/data]
source: roman
ai_weight: high
created: 2026-02-10
updated: 2026-02-13
---
# Потоки данных

## Обзор

Основные потоки данных в инфраструктуре, их маршруты и участники.

## 1. Telegram → CRM Pipeline

```
Telegram Bot
    ↓ MTProto API
telegram-forwarder (Docker, VPS)
    ↓ webhook
n8n (Telegram Webhook)
    ↓
n8n (Telegram Lead Processor)
    ├──→ PostgreSQL (хранение лидов)
    ├──→ Groq / OpenRouter (LLM-обработка)
    └──→ Bitrix24 CRM (REST API, создание лида)
         ↓
    n8n (Скорринг клиентов)
         ↓
    n8n (Подсчет звонков по лидам)
```

**Критичность:** высокая
**Данные:** текст сообщений, контакты, аудио
**Задержка:** секунды (real-time webhook)

## 2. ASR Pipeline (распознавание речи)

```
Аудио (из Telegram / другой источник)
    ↓
n8n (ASR Submit)
    ↓ HTTP API
faster-whisper (Docker, VPS)
    ↓ callback
n8n → результат (текст)
    ↓
PostgreSQL / дальнейшая обработка
```

**Критичность:** средняя
**Данные:** аудиофайлы → текст
**Модель:** faster-whisper (large-v3)

## 3. OCR Pipeline (распознавание текста)

```
Изображение (скриншот / скан)
    ↓
Python скрипт
    ├──→ PaddleOCR (localhost:8080) → сырой текст
    └──→ Tesseract OCR → сырой текст
         ↓
    Ollama (qwen3:30b, localhost:11434) → улучшенный текст
         ↓
    Markdown / структурированные данные
```

**Критичность:** средняя
**Данные:** изображения → текст
**Локально:** да (iMac Pro)

## 4. LLM API Routing

```
Инструмент (Continue / Cursor / Dify / n8n)
    │
    ├──→ Ollama (localhost:11434) — локальные модели
    │    ├── qwen3:30b (основная)
    │    ├── qwen3-coder:30b (код)
    │    ├── deepseek-r1:8b (reasoning)
    │    ├── llama3.1:8b (быстрая)
    │    ├── qwen2.5-coder:1.5b (autocomplete)
    │    └── nomic-embed-text (embeddings)
    │
    ├──→ OpenRouter API (через VPS ISHosting USA / прямой)
    │    ├── DeepSeek R1T2 Chimera
    │    └── DeepSeek R1 0528
    │
    ├──→ Groq API (через n8n credentials)
    │    └── (модель не зафиксирована)
    │
    └──→ Anthropic API (Claude Code, Claude Desktop)
         └── Claude Sonnet 4.5, Claude Opus 4.6
```

**Роутинг API:**
- Россия → некоторые API заблокированы → VPS ISHosting USA (149.33.4.37, US) как egress proxy
- DNS: ComSS DNS (76.76.2.22) для обхода блокировок

## 5. Синхронизация файлов

```
Google Drive (облако)
    ↕ rclone bisync
Bitrix24 (WebDAV, HR-документы)

Google Drive (облако)
    ↕ Google Drive for Desktop
~/Google Drive/ (iMac Pro)
    ↕ Obsidian vault
~/Documents/ (Obsidian, iMac Pro)
```

**Критичность:** средняя
**Данные:** документы, файлы

## 6. Web → Сервисы (Ingress)

```
Internet
    ↓ HTTPS (443)
Traefik (VPS Beget, Docker)
    ├──→ n8n.fingroup.ru → n8n:5678
    ├──→ dify.fingroup.ru → Dify
    └──→ [другие поддомены]

WireGuard VPN (10.66.66.0/24)
    └──→ MCP-n8n:3900 (Docker internal)
         ↓
    Cursor / Claude Desktop (MCP client)
```

**Критичность:** высокая
**TLS:** Let's Encrypt (автообновление через Traefik)

## 7. AI Agents Pipeline

```
CEO (Telegram / Claude Code)
    |
Chief of Staff (координатор)
    |-> фиксация задач (tasks__20260214205155.md)
    |-> приоритизация (URGENT/HIGH/NORMAL/LOW)
    |-> делегирование
         |
         |-> Agent Creator -> создание новых агентов
         |-> @ops-automation-lead (roadmap)
         |-> @content-ops (roadmap)
         |-> @growth-analyst (roadmap)

Personal Assistant (Telegram Bot)
    |
    |-> aiogram 3.x -> Telegram API
    |-> Whisper API -> Speech-to-Text
    |-> Claude API -> NLU (понимание команд)
    |-> Task Router -> Specialized Agents
    |-> Qdrant (векторная память)
    |-> PostgreSQL (структурированные данные)
    |-> Redis (кэш, очереди)
```

**Критичность:** высокая (координация всех бизнес-процессов)
**Протокол:** JSON-RPC over filesystem
**Данные:** задачи, события, контекст, память

## Сводная матрица

| Поток | Источник | Назначение | Протокол | Критичность |
|-------|---------|-----------|----------|:----------:|
| Telegram→CRM | Telegram | Bitrix24 | API/webhook | Высокая |
| ASR | Аудио | Текст | HTTP API | Средняя |
| OCR | Изображения | Текст | localhost | Средняя |
| LLM Routing | Инструменты | LLM API | HTTP/API | Высокая |
| Файловая синхр. | Google Drive | Bitrix24/локально | WebDAV/bisync | Средняя |
| Web Ingress | Internet | Сервисы VPS | HTTPS/VPN | Высокая |
| MCP | IDE | Сервисы | stdio/SSE | Высокая |
| AI Agents | CEO (Telegram) | Агенты, БД | JSON-RPC/API | Высокая |

---

## Links (internal)

- [[infra_all_instruments/docs/integrations/_index__20260210220000-07|Карта интеграций]]
- [[infra_all_instruments/docs/integrations/n8n-workflows__20260210220500-01|n8n Воркфлоу]]
- [[infra_all_instruments/docs/integrations/mcp-topology__20260210220500-02|MCP Топология]]
- [[infra_all_instruments/docs/infrastructure/vps-beget__20260210220200-01|VPS Beget]]
- [[infra_all_instruments/docs/infrastructure/traefik__20260210220200-05|Traefik]]
- [[infra_all_instruments/docs/neural-networks/by-runtime/ollama-local__20260210220400-19|Ollama Local]]

## История

- 2026-02-10: Создана карта потоков данных
