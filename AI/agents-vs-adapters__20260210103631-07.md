---
id: 20260210103631-07
title: Agents-vs-Adapters-Standard — разделение AGENTS.md и адаптеров
summary: >
  Стандарт разделения правил между AGENTS.md (общее для всех AI) и адаптерами (инструмент-специфичное). Предотвращает дублирование и конфликты.
type: spec
status: active
tags: [docops/agentops, docops/rules, ai/agents]
source: claude-opus-4-6
ai_weight: high
created: 2026-02-10
updated: 2026-02-10
---
# AGENTS-VS-ADAPTERS-STANDARD — РАЗДЕЛЕНИЕ ПРАВИЛ

## НАЗНАЧЕНИЕ

Стандарт определяет, что должно находиться в `AGENTS.md` (центральный коммутатор правил), а что — в инструмент-специфичных адаптерах (`CLAUDE.md`, `.cursorrules`, `.github/copilot-instructions.md` и т.д.).

**Цель:** Предотвратить дублирование правил, избежать конфликтов между инструментами, упростить поддержку.

---

## ПРИНЦИП РАЗДЕЛЕНИЯ

### AGENTS.md — правила для ВСЕХ AI

AGENTS.md содержит правила, **которые должны соблюдать ВСЕ AI-инструменты без исключения**.

**Критерий:** "Это правило должно работать в Claude Code, Cursor, Copilot, ChatGPT — одинаково?"

**Если ДА** → правило идёт в AGENTS.md
**Если НЕТ** → правило идёт в адаптер

### Адаптеры — инструмент-специфичные настройки

Адаптеры содержат настройки, **специфичные для конкретного AI-инструмента**.

**Критерий:** "Это правило использует функции, которые есть только в этом инструменте?"

**Если ДА** → правило идёт в адаптер
**Если НЕТ** → правило идёт в AGENTS.md

---

## ЧТО ИДЁТ В AGENTS.MD

### 1. Стандарты документации

Все правила DocOps/AgentOps применяются для ВСЕХ инструментов:

```yaml
## RULES (TRI-STATE)
- docops_core: true            # Базовые принципы — для всех AI
- docops_standard: true        # Стандарт YAML, ID, ссылок — для всех AI
- docops_schema_required: true # YAML-схема — для всех AI
- docops_source_allowlist: true # Allowlist source — для всех AI
- readme_standard: true        # README.md правила — для всех AI
- architecture_standard: true  # ARCHITECTURE__20260210103632-01.md правила — для всех AI
```

### 2. Бизнес-правила проекта

```yaml
## PROJECT NOTES
- Проект — внутренняя система, не публичный API
- Язык документации — русский
- Все PR требуют review от @team-lead
```

### 3. Архитектурные ограничения

```yaml
## PROJECT NOTES
- Не использовать async/await в legacy модулях (src/archive/)
- Все новые endpoints должны иметь OpenAPI-спецификацию
- Тесты обязательны для всех public функций
```

### 4. Правила безопасности

```yaml
## PROJECT NOTES
- Никогда не коммитить secrets, API keys, passwords
- Переменные окружения только через .env файлы (они в .gitignore)
- SQL-запросы только через параметризованные запросы (не f-strings)
```

### 5. Процессные правила

```yaml
## RULES (TRI-STATE)
- ai_project_development_rules: true   # Поведение AI — для всех AI
- progressive_validation: true         # Валидация документации — для всех AI
```

---

## ЧТО ИДЁТ В АДАПТЕРЫ

### CLAUDE.md — только для Claude Code

**Claude-специфичные настройки:**

```markdown
## CLAUDE-SPECIFIC SETTINGS

### Hooks (Claude Code feature)
# Pre-tool hooks, post-save hooks — специфичны для Claude Code

### Skills (Claude Code feature)
# /commit, /review-pr — специфичны для Claude Code

### Keyboard Shortcuts (Claude Code feature)
# Ctrl+R для запуска тестов — специфично для Claude Code
```

**Проектные заметки, полезные именно для Claude Code:**

```markdown
## PROJECT NOTES

# Контекстные подсказки для Claude Code
- Этот проект использует монорепо с nx (claude плохо понимает nx без подсказки)
- Основная БД — PostgreSQL 15 с pgvector extension
```

### .cursorrules — только для Cursor

```
# Cursor-специфичные правила
# Определение контекстного окна
# Игнорирование файлов при индексации
```

### .github/copilot-instructions.md — только для Copilot

```markdown
# GitHub Copilot специфичные инструкции
# Правила автодополнения
# Контекст проекта для Copilot
```

---

## МАТРИЦА РАЗДЕЛЕНИЯ

| Тип правила | AGENTS.md | CLAUDE.md | .cursorrules | Copilot |
|-------------|-----------|-----------|--------------|---------|
| DocOps стандарты (YAML, ID) | ✅ | ❌ | ❌ | ❌ |
| Язык документации | ✅ | ❌ | ❌ | ❌ |
| Бизнес-правила проекта | ✅ | ❌ | ❌ | ❌ |
| Архитектурные ограничения | ✅ | ❌ | ❌ | ❌ |
| Правила безопасности | ✅ | ❌ | ❌ | ❌ |
| AI поведение (проактивность) | ✅ | ❌ | ❌ | ❌ |
| Claude hooks | ❌ | ✅ | ❌ | ❌ |
| Claude skills (/commit) | ❌ | ✅ | ❌ | ❌ |
| Cursor context window | ❌ | ❌ | ✅ | ❌ |
| Cursor file ignoring | ❌ | ❌ | ✅ | ❌ |
| Copilot autocomplete rules | ❌ | ❌ | ❌ | ✅ |
| Проектные заметки (общие) | ✅ | ❌ | ❌ | ❌ |
| Проектные заметки (Claude) | ❌ | ✅ | ❌ | ❌ |

---

## ДЕРЕВО ПРИОРИТЕТОВ

```
Правило для проекта
│
├── Применимо ко ВСЕМ AI?
│   ├── ДА → AGENTS.md
│   └── НЕТ → В адаптер конкретного инструмента
│
└── Это правило DocOps?
    ├── ДА → AGENTS.md (даже если читает только один инструмент)
    └── НЕТ → Проверить, нет ли уже в AGENTS.md
```

---

## ПРИМЕРЫ ПРАВИЛЬНОГО РАЗДЕЛЕНИЯ

### ✅ Правильно

**AGENTS.md:**
```yaml
## RULES (TRI-STATE)
- docops_core: true
- docops_standard: true
- ai_project_development_rules: true

## PROJECT NOTES
- Язык документации: русский
- Не коммитить secrets
- Тесты обязательны для public API
```

**CLAUDE.md:**
```markdown
## CLAUDE-SPECIFIC SETTINGS

### Hooks
- pre-save: запускать docops-lint.py

## PROJECT NOTES
- Для анализа проекта начни с ebk_config.md (SSOT)
```

### ❌ Неправильно — дублирование

**AGENTS.md:**
```yaml
## PROJECT NOTES
- Не коммитить secrets ← ПРАВИЛО ДЛЯ ВСЕХ
```

**CLAUDE.md:**
```markdown
## PROJECT NOTES
- Не коммитить API keys, passwords ← ДУБЛИРУЕТ AGENTS.MD
```

**Проблема:** При изменении правила придётся обновлять оба файла. AI может получить противоречивые инструкции.

### ❌ Неправильно — Claude hooks в AGENTS.md

**AGENTS.md:**
```yaml
## PROJECT NOTES
- При сохранении файла: запустить docops-lint.py ← CURSOR НЕ ПОНИМАЕТ CLAUDE HOOKS
```

**Правильно:**
```markdown
## CLAUDE.md
### Hooks
- post-save *.md: python3 scripts/docops-lint.py {file}
```

---

## КАК РАСПОЗНАТЬ ДУБЛИРОВАНИЕ

AI при чтении AGENTS.md и адаптеров **ОБЯЗАНА** проверить:

```python
BEFORE adding rule to adapter:
  CHECK AGENTS.md → PROJECT NOTES
  IF same rule exists in AGENTS.md:
    → WARN: "Это правило уже есть в AGENTS.md. Добавление в CLAUDE.md создаст дублирование."
    → DON'T ADD to adapter

BEFORE adding rule to AGENTS.md:
  CHECK all adapters__20260209220613-06 (CLAUDE.md, .cursorrules)
  IF same rule exists in adapter:
    → WARN: "Это правило есть в {adapter}. Переместить в AGENTS.md для всех инструментов?"
    → SUGGEST migration
```

---

## МИГРАЦИЯ КОНФЛИКТУЮЩИХ ПРАВИЛ

### Сценарий: Правило есть и в AGENTS.md, и в CLAUDE.md

```
1. ОПРЕДЕЛИТЬ, для кого правило:
   - Для всех AI → оставить в AGENTS.md, удалить из CLAUDE.md
   - Только для Claude → удалить из AGENTS.md, оставить в CLAUDE.md

2. ПРОВЕРИТЬ содержание:
   - Правила одинаковые? → удалить дубликат
   - Правила разные? → это КОНФЛИКТ, нужно решение

3. ЗАФИКСИРОВАТЬ решение:
   - В ARCHITECTURE__20260210103632-01.md → Design Decisions
   - ИЛИ в NOTE в AGENTS.md: "Правило X только для Claude (в CLAUDE.md)"
```

### Сценарий: Перенос .cursorrules → AGENTS.md

```
При bootstrap старого проекта с .cursorrules:
  1. Прочитать .cursorrules
  2. Для каждого правила определить: общее или cursor-специфичное?
  3. Общие правила → AGENTS.md → PROJECT NOTES
  4. Cursor-специфичные → оставить в .cursorrules
  5. Не удалять .cursorrules (он нужен для Cursor)
  6. Добавить NOTE в AGENTS.md: "Cursor-специфичные правила в .cursorrules"
```

---

## ИСКЛЮЧЕНИЯ И СПОРНЫЕ СЛУЧАИ

### Исключение 1: Проектные заметки для конкретного AI

Иногда AI-инструменту нужна специфическая форма подачи информации:

```markdown
# AGENTS.md
## PROJECT NOTES
- Основной entry point: src/main.py

# CLAUDE.md (ДОПУСТИМО — дополняет, не дублирует)
## PROJECT NOTES
- Для анализа проекта: начни с `ebk_config.md`, затем `ebk_tz_apps_script.md`
- Claude Code контекст: этот проект — knowledge base, не codebase
```

**Правило:** Адаптер МОЖЕТ уточнять или расширять информацию из AGENTS.md для конкретного инструмента, но НЕ ДОЛЖЕН противоречить ей.

### Исключение 2: Формат инструкций

Разные AI-инструменты лучше понимают разные форматы:

```markdown
# AGENTS.md (общий стиль)
## PROJECT NOTES
- Язык документации: русский

# .cursorrules (Cursor-специфичный формат)
# Respond in Russian
# Use Russian for all comments and documentation
```

**Это НЕ дублирование** — это адаптация формата для конкретного инструмента.

### Исключение 3: Уточняющие инструкции

```markdown
# AGENTS.md
## PROJECT NOTES
- Не коммитить secrets

# CLAUDE.md (ДОПУСТИМО — уточняет для Claude)
## PROJECT NOTES
- При создании git commit: проверить наличие .env, *.key, *password* в staged files
```

**Это НЕ дублирование** — это конкретизация общего правила для конкретного инструмента.

---

## ПРОВЕРКА COMPLIANCE

### Чеклист: AGENTS.md содержит только общие правила?

```
[ ] Все правила в RULES (TRI-STATE) применимы ко всем AI
[ ] PROJECT NOTES не содержит Claude-специфичных команд (hooks, /slash)
[ ] PROJECT NOTES не содержит Cursor-специфичных команд
[ ] Нет дублирования с CLAUDE.md (проверить пересечение)
[ ] Нет дублирования с .cursorrules (если есть)
```

### Чеклист: CLAUDE.md содержит только Claude-специфичное?

```
[ ] Нет дублирования DocOps правил из AGENTS.md
[ ] Нет общих бизнес-правил (они должны быть в AGENTS.md)
[ ] Есть ссылка на AGENTS.md как источник истины
[ ] Hooks — только Claude-совместимые
[ ] Skills — только Claude-совместимые
[ ] PROJECT NOTES дополняет AGENTS.md, но не противоречит
```

---

## LINKS (INTERNAL)

- [[agents-format__20260209220613-05|AGENTS-Format]] — формат AGENTS.md и tri-state режимы
- [[adapters__20260209220613-06|Adapters]] — список инструментов и их адаптеров
- [[ai-project-development-rules__20260210103631-05|AI-Project-Development-Rules]] — правила поведения AI
- [[docops-standard__20260209220613-02|DocOps-Standard]] — стандарт документации

---

**Примечание:** Этот стандарт описывает принципы разделения. Технические форматы файлов см. в [[agents-format__20260209220613-05|agents-format]] и [[adapters__20260209220613-06|adapters]].
