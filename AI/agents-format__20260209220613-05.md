---
id: 20260209220613-05
title: AGENTS-Format — стандарт файла AGENTS.md и tri-state режимов
summary: >
  Описывает структуру AGENTS.md как центрального коммутатора правил проекта: управляемый блок AGENTOPS, tri-state режимы, принципы минимализма, конвенция memory/patterns для зрелых проектов.
type: spec
status: active
tags: [docops/agentops, docops/rules, ai]
source: claude-opus-4-6
ai_weight: high
created: 2026-02-09
updated: 2026-02-09
---
# AGENTS-FORMAT

## 1) НАЗНАЧЕНИЕ

`AGENTS.md` — центральный файл проекта, определяющий какие правила применяются и в каком режиме. Это **tool-entrypoint**, а не DocOps-документ: без YAML frontmatter, фиксированное имя.

Ключевой принцип: **AGENTS.md — коммутатор, а не склад текста**.

## 2) TRI-STATE РЕЖИМЫ ПРАВИЛ

| Режим | Поведение |
|-------|-----------|
| `true` | Правило обязательно — агент читает файл и применяет всегда |
| `false` | Правило запрещено — агент не читает файл и не применяет |
| `auto` | Правило условно — агент может применить при явной релевантности, указав причину |

### ПОЛИТИКА ДЛЯ AUTO
Агент обязан: явно указать, применяется ли правило; если да — 1–2 строками объяснить «почему релевантно».

## 3) УПРАВЛЯЕМЫЙ БЛОК AGENTOPS

AGENTS.md содержит управляемый блок между маркерами:

```md
<!-- AGENTOPS:BEGIN -->
## Rule switchboard (tri-state)
# template-version: YYYY-MM-DD-vN
# Format: - <rule-ref> : <mode> — <description> | notes: <optional>

- rule-name__ID : true — описание правила | notes:
<!-- AGENTOPS:END -->
```

### ПРАВИЛА БЛОКА
- Скрипт обновляет **только содержимое внутри маркеров**.
- Контент вне маркеров — проектные заметки, скрипт их не трогает.
- При MERGE: mode и notes проекта сохраняются, описание обновляется из template.

## 4) МИНИМАЛИЗМ

AGENTS.md содержит:
- Управляемый блок с правилами и режимами.
- Проектные заметки (опционально, вне блока).

AGENTS.md **не содержит**:
- Длинные регламенты.
- Подробные схемы или allowlist.
- YAML frontmatter.

## 5) ВЫКЛЮЧЕНИЕ БЕЗ УДАЛЕНИЯ

Если правило нужно временно не применять: переключить режим на `false`. Файлы правил остаются в проекте для будущего включения.

## 6) СТРУКТУРА AI/ — ПРАВИЛА, ПАМЯТЬ, ПАТТЕРНЫ

Правила (rules) всегда лежат плоско в `AI/`. Подкаталоги `memory/` и `patterns/` создаются **по потребности**, когда проект дорос.

```
AI/
├── docops-core__ID.md           ← правила (плоские, всегда)
├── docops-standard__ID.md
├── ...
├── memory/                      ← история решений (когда появилась)
│   ├── decisions__ID.md
│   └── changelog__ID.md
└── patterns/                    ← переиспользуемые шаблоны (когда есть 2+ повторения)
    └── http-retry__ID.md
```

### ТРИ ТИПА ЗНАНИЯ

| Каталог | Тип | Жизненный цикл | Загрузка AI |
|---------|-----|-----------------|-------------|
| `AI/` (корень) | Предписания — что делать | Редко меняется | Всегда |
| `AI/memory/` | История — что решили | Append-only, растёт | По запросу |
| `AI/patterns/` | Шаблоны — как делать | Эволюционирует | При создании/рефакторе |

### ПРАВИЛА СОЗДАНИЯ ПОДКАТАЛОГОВ

- **Не создавать пустые.** Пустая папка = шум. Первый файл → создаётся каталог.
- **memory/** — первое записанное решение или changelog. Типичные документы: `decisions`, `changelog`, `audit-log`.
- **patterns/** — второе повторение подхода. Первый раз — ещё не паттерн. Второй раз видишь тот же приём → извлекаешь в patterns/.
- **Файлы в подкаталогах** следуют тем же DocOps-правилам: YAML, ID в имени, Obsidian-ссылки.
- **AGENTS.md switchboard** управляет только правилами из корня `AI/`. Memory и patterns — не в switchboard.

---

## LINKS (INTERNAL)

- [[docops-core__20260209220613-01|DocOps-Core]] — ядро правил
- [[docops-standard__20260209220613-02|DocOps-Standard]] — полный регламент
- [[adapters__20260209220613-06|Adapters]] — адаптеры правил под инструменты
